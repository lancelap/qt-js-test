{"version":3,"sources":["components/Marker.js","components/Polyline.js","components/MarkerForm.js","components/MarkerList.js","components/Loader.js","components/YandexMap.js","App.js","loadScriptMap.js","index.js"],"names":["Marker","clickHandeler","index","deleteMarker","e","preventDefault","_this2","this","_this$props","props","addDragEndListener","text","id","mapY","ymaps","coordinates","getCenter","placemark","Placemark","balloonContent","draggable","geoObjects","add","events","geometry","getCoordinates","timestamp","remove","_this$props2","opacity","isDragging","connectDragSource","connectDropTarget","react_default","a","createElement","className","style","onClick","Component","flow","DragSource","beginDrag","connect","monitor","dragSource","DropTarget","hover","component","dragIndex","getItem","hoverIndex","moveMarker","dropTarget","Polyline","_this","Object","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","polyline","markers","setCoordinates","MarkerForm","onChangeMarkerTitle","setState","target","value","onSubmit","addMarker","Date","now","state","type","placeholder","onChange","MarkerList","marker","toConsumableArray","concat","update","$splice","dragCard","markersArr","coords","forEach","push","components_Marker","key","components_MarkerForm","components_Polyline","Loader","YandexMap","width","height","App","_Component","loaded","mapId","inherits","createClass","url","Promise","resolve","reject","script","document","body","getElementsByTagName","match","window","initYandexMap","Error","src","onerror","appendChild","then","initMap","catch","error","console","_this$state","components_MarkerList","components_Loader","components_YandexMap","Map","center","zoom","DragDropContext","HTML5Backend","ReactDOM","render","src_App","getElementById"],"mappings":"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","file":"static/js/main.c8748342.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport {DragSource, DropTarget} from 'react-dnd';\nimport flow from 'lodash/flow';\n\nconst cardSource = {\n  beginDrag(props) {\n    return {\n      id: props.id,\n      index: props.index,\n    };\n  },\n};\n\nconst cardTarget = {\n  hover(props, monitor, component) {\n    const dragIndex = monitor.getItem().index;\n    const hoverIndex = props.index;\n\n    // Don't replace items with themselves\n    if (dragIndex === hoverIndex) {\n      return;\n    }\n\n    // Time to actually perform the action\n    props.moveMarker(dragIndex, hoverIndex);\n\n    // Note: we're mutating the monitor item here!\n    // Generally it's better to avoid mutations,\n    // but it's good here for the sake of performance\n    // to avoid expensive index searches.\n    monitor.getItem().index = hoverIndex;\n  },\n};\n\nclass Marker extends Component {\n  componentDidMount() {\n    const {addDragEndListener, text, id, mapY, ymaps} = this.props;\n    const coordinates = mapY.getCenter();\n\n    const placemark = new ymaps.Placemark(coordinates, {\n      balloonContent: this.props.text\n    }, { \n      draggable: true \n    });\n\n    this.placemark = placemark;\n    \n    mapY.geoObjects.add(placemark); \n\n    placemark.events.add('dragend', () => {\n      const coordinates = placemark.geometry.getCoordinates();\n      addDragEndListener(this.props.index, {timestamp: id, text, coordinates});\n    });\n  }\n\n  componentWillUnmount() {\n    this.placemark.events.remove('dragend');\n    this.props.mapY.geoObjects.remove(this.placemark);\n  }\n\n  render() {\n    const {\n      text, \n      index, \n      deleteMarker,\n      isDragging,\n      connectDragSource,\n      connectDropTarget \n    } = this.props;\n\n    const opacity = isDragging ? 0 : 1;\n\n    return (\n      connectDragSource(\n        connectDropTarget(\n          <li className='marker' style={{opacity}}>\n            <p className='marker__text'>{text}</p>\n            <button className='marker__button' onClick={this.clickHandeler(index, deleteMarker)}>X</button>\n          </li>\n        ),\n      )\n    );\n  }\n\n  clickHandeler = (index, deleteMarker) => (e) => {\n    e.preventDefault();\n    deleteMarker(index);\n  }\n}\n\nexport default flow(\n  DragSource(\n    'marker',\n    cardSource,\n    (connect, monitor) => ({\n      connectDragSource: connect.dragSource(),\n      isDragging: monitor.isDragging(),\n    }),\n  ),\n  DropTarget('marker', cardTarget, (connect) => ({\n    connectDropTarget: connect.dropTarget(),\n  }))\n)(Marker);\n\nMarker.propTypes = {\n  id: PropTypes.number.isRequired,\n  deleteMarker: PropTypes.func.isRequired, \n  addDragEndListener: PropTypes.func.isRequired, \n  text: PropTypes.string.isRequired,\n  index: PropTypes.number.isRequired\n};\n","import { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nclass Polyline extends Component {\n  constructor() {\n    super();\n    this.polyline = null;\n    this.index = null;\n  }\n\n  componentDidMount() {\n    const {markers, ymaps, mapY} = this.props;\n    this.polyline = new ymaps.Polyline(markers);\n    mapY.geoObjects.add(this.polyline);\n  }\n  \n  componentDidUpdate() {\n    const {markers} = this.props;\n    this.polyline.geometry.setCoordinates(markers);\n  }\n  \n  render() {\n    return null;\n  }\n}\n\nPolyline.propTypes = {\n  markers: PropTypes.array.isRequired,\n  mapY: PropTypes.object.isRequired,\n  ymaps: PropTypes.object.isRequired\n};\n\nexport default Polyline;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nclass MarkerForm extends Component {\n  constructor() {\n    super();\n    this.state = {\n      text: ''\n    };\n  }\n\n  render() {\n    return(\n      <form className='marker-form' onSubmit={this.onSubmit}>\n        <input className='marker-form__input'\n          type=\"text\"\n          value={this.state.text}\n          placeholder=\"Новая точка маршрута\" \n          onChange={this.onChangeMarkerTitle} />\n      </form>\n    );\n  }\n\n  onChangeMarkerTitle = (e) => {\n    this.setState({\n      text: e.target.value\n    });\n  }\n\n  onSubmit = (e) => {\n    e.preventDefault();\n    this.props.addMarker(Date.now(), this.state.text, this.props.mapY.getCenter());\n    this.setState({text: ''});\n  }\n}\n\nMarkerForm.propTypes = {\n  addMarker: PropTypes.func.isRequired, \n  mapY: PropTypes.object.isRequired\n};\n\nexport default MarkerForm;\n","import React, {Component} from 'react';\nimport update from 'immutability-helper';\nimport Marker from './Marker';\nimport Polyline from './Polyline';\nimport PropTypes from 'prop-types';\nimport MarkerForm from './MarkerForm';\n\nclass MarkerList extends Component {\n  constructor() {\n    super();\n\n    this.state = {\n      markers: [],\n    };\n  }\n  \n  render() {  \n    const {markers} = this.state;\n    const {mapY, ymaps} = this.props;\n    let markersArr = [];\n    let coords = [];\n\n    markers.forEach((marker, index) => {\n      coords.push(marker.coordinates);\n      markersArr.push(<Marker\n        key={marker.timestamp}\n        text={marker.text}\n        id={marker.timestamp}\n        deleteMarker={this.deleteMarker}\n        index={index}\n        moveMarker={this.moveMarker}\n        addDragEndListener={this.addDragEndListener} \n        ymaps={ymaps} \n        mapY={mapY} />);\n    });\n\n    return (\n      <div>\n        <MarkerForm \n          addMarker={this.addMarker} \n          mapY={mapY} />\n\n        <ul className='marker-list'>\n          {markersArr}\n        </ul>\n\n        <Polyline \n          markers={coords} \n          ymaps={ymaps} \n          mapY={mapY} />\n      </div>\n    );\n  }\n\n  addMarker = (id, text, coordinates) => {\n    const marker = {timestamp: id, text, coordinates};\n    this.setState({\n      markers: [...this.state.markers, marker]\n    });\n  }\n\n  deleteMarker = (index) => {\n    this.setState(\n      update(this.state, {\n        markers: {\n          $splice: [[index, 1]]\n        }\n      })\n    );\n  }\n\n  addDragEndListener = (index, placemark) => {\n    this.setState(\n      update(this.state, {\n        markers: {\n          $splice: [[index, 1, placemark]]\n        }\n      })\n    );\n  }\n\n  moveMarker = (dragIndex, hoverIndex) => {\n    const {markers} = this.state;\n    const dragCard = markers[dragIndex];\n\n    this.setState(\n      update(this.state, {\n        markers: {\n          $splice: [[dragIndex, 1], [hoverIndex, 0, dragCard]],\n        },\n      }),\n    );\n  }\n}\n\nMarkerList.propTypes = {\n  mapY: PropTypes.object.isRequired,\n  ymaps: PropTypes.object.isRequired\n};\n\nexport default MarkerList;\n\n\n  ","import React from 'react';\n\nconst Loader = () => {\n  return (\n    <p>Loading...</p>\n  );\n};\n\nexport default Loader;\n","import React, {Component} from 'react';\n\nclass YandexMap extends Component {\n  shouldComponentUpdate() {\n    return false;\n  }\n\n  render() {\n    return (\n      <div \n        id={this.props.id} \n        className='yandex-map'\n        style={{width: '450px', height: '450px'}}>\n      </div>\n    );\n  }\n}\n\nexport default YandexMap;\n","import React, { Component } from 'react';\nimport HTML5Backend from 'react-dnd-html5-backend';\nimport { DragDropContext } from 'react-dnd';\nimport loadScriptMap from './loadScriptMap';\nimport MarkerList from './components/MarkerList';\nimport Loader from './components/Loader';\nimport YandexMap from './components/YandexMap';\n\nexport class App extends Component {\n  constructor() {\n    super();\n    this.state = {\n      loaded: false,\n      mapId: 'YMapsID',\n      mapY: null,\n      ymaps: null\n    };\n  }\n\n  componentDidMount() {\n    loadScriptMap('https://api-maps.yandex.ru/2.1/?lang=ru_RU&onload=initYandexMap')\n      .then((ymaps) => {\n        this.initMap(ymaps);\n      })\n      .catch(error => console.error(error));\n  }\n\n  render() {\n    const {loaded, mapId, ymaps, mapY} = this.state;\n    return (      \n      <div className='map'>\n        {loaded ? (\n          <MarkerList ymaps={ymaps} mapY={mapY}/>\n        ) : (\n          <Loader />\n        )}\n        <YandexMap id={mapId} />\n      </div>);\n  }\n\n  initMap(ymaps) {\n    const mapY = new ymaps.Map(this.state.mapId, {\n      center: [55.87, 37.66],\n      zoom: 10\n    });\n\n    this.setState({\n      loaded: true,\n      mapY: mapY,\n      ymaps: ymaps\n    });\n  }\n}\nexport default DragDropContext(HTML5Backend)(App);\n","export default function loadScriptMap(url) {\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script'); \n    const body = document.getElementsByTagName('body')[0];\n    \n    if(url.match(/onload=initYandexMap/)) {\n      window.initYandexMap = (ymaps) => resolve(ymaps);\n    } else {\n      reject(new Error('require onload func'));\n    }\n\n    script.src = url;\n    script.onerror = reject;\n    body.appendChild(script);\n  });\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}